<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>jFractal library demo page</title>
  <meta name="description" content="jFractal library demo page">
  <meta name="author" content="Julien Descamps">
  <style>
  body {
    width: 1000px;
    margin: 0 auto;
    font-family: Verdana, Geneva, sans-serif;
  }
  main {
    background-color: #eee;
    border: 1px solid #bbb;
    padding: 5px;
    height: 552px;
    border-radius: 5px;
  }
  canvas {
    float: left;
    width: 750px;
    height: 550px;
    border: 1px solid #bbb;
    border-radius: 5px;
  }
  form {
    float: right;
    width: 200px;
    border: 1px solid #bbb;
    height: 550px;
    background-color: #eee;
    padding: 0 15px;
    border-radius: 5px;
  }
  select, input {
    width: 100%;
  }
  h2 {
    text-align: center;
  }
  label {
    display: block;
    font-weight: bold;
  }
  </style>
</head>
<body>
  <header>
    <h1>jFractal library demo page</h1>
  </header>
  <main>
    <canvas id="fractal" width="750" height="550"></canvas>
    <form>
      <h2>Parameters</h2>
      <p><em>Click on the picture to zoom into the fractal.</em></p>
      <p>
        <label for="equation">Equation</label>
        <select id="equation" name="equation">
          <option value="mandelbrot">Mandelbrot</option>
          <option value="tricorn">Tricorn</option>
          <option value="burning">Burning Ship</option>
          <option value="newton">Newton</option>
        </select>
      </p>

      <p>
        <label for="coloring">Coloring</label>
        <select id="coloring" name="coloring">
          <option value="bailout">Simple Bailout</option>
          <option value="smoothbailout">Smooth Bailout</option>
          <option value="binary">Binary</option>
          <option value="angle">Angle</option>
          <option value="simple">Simple</option>
        </select>
      </p>

      <p>
        <label for="palette">Palette</label>
        <select id="palette" name="palette">
          <option value="night">Night</option>
          <option value="rainbow">Rainbow</option>
          <option value="fire">Fire</option>
          <option value="sky">Sky</option>
          <option value="blacknwhite">Black N White</option>
        </select>
      </p>

      <p>
        <label for="julia">Julia Set</label>
        <select id="julia" name="julia">
          <option value="">---</option>
          <option value="set1">Set 1</option>
          <option value="set2">Set 2</option>
          <option value="set3">Set 3</option>
          <option value="set4">Set 4</option>
          <option value="set5">Set 5</option>
          <option value="set6">Set 6</option>
        </select>
      </p>

      <p>
        <label for="iterations">Iterations</label>
        <input type="text" id="iterations">
        <button type="button" id="button">Go</button>
      </p>
      </form>
    </main>

    <script src="jpalette.js"></script>
    <script src="jfractal.js"></script>

    <script>
    (function() {

      /***** Global variables *****/

      var
       canvas     = document.getElementById('fractal'),
       equation   = document.getElementById('equation'),
       coloring   = document.getElementById('coloring'),
       palette    = document.getElementById('palette'),
       julia      = document.getElementById('julia'),
       iterations = document.getElementById('iterations'),
       button     = document.getElementById('button'),
       // Namespaces
       f = jFractal,
       p = jPalette,
       // Colors
       black  = p.Color.get('black')(255),
       white  = p.Color.get('white')(255),
       // Palettes
       night       = p.ColorMap.get('night')(2000),
       rainbow     = p.ColorMap.get('rainbow')(2000),
       fire        = p.ColorMap.get('fire')(2000),
       sky         = p.ColorMap.get('sky')(2000),
       blacknwhite = p.ColorMap.get('blacknwhite')(2000),
       // Equations
       mandelbrotEquation = new f.MandelbrotEquation(),
       tricornEquation    = new f.TricornEquation(),
       burningEquation    = new f.BurningShipEquation(),
       newtonEquation     = new f.NewtonEquation();
       // Algorithms
       bailoutAlgo = new f.BailoutAlgo(mandelbrotEquation, 40, 4),
       newtonAlgo  = new f.NewtonAlgo(newtonEquation, 40, 0.001),
       // Colorings
       simpleColoring        = new f.SimpleColoring(bailoutAlgo, black, white);
       bailoutColoring       = new f.BailoutColoring(bailoutAlgo, black, night);
       smoothBailoutColoring = new f.SmoothBailoutColoring(bailoutAlgo, black, night);
       angleColoring         = new f.AngleColoring(bailoutAlgo, black, night);
       binaryColoring        = new f.BinaryColoring(bailoutAlgo, black, white, black),
       // General
       picture = new f.Picture(canvas, new f.Complex(), {re:3, im:3}, true),
       display = new f.ProgressiveDisplay(picture, bailoutColoring),
       // Julia sets
       c1 = new f.Complex(0.285, 0.01),
       c2 = new f.Complex(-0.11, 0.6557),
       c3 = new f.Complex(-0.8, 0.156),
       c4 = new f.Complex(-0.835, -0.2321),
       c5 = new f.Complex(-0.70176,-0.3842),
       c6 = new f.Complex(0, 1);

      /********** Functions **********/

      var getCursorPosition = function (e) {
        var x, y;

        if (e.pageX !== undefined && e.pageY !== undefined) {
          x = e.pageX;
          y = e.pageY;
        } else {
          x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
          y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
        }
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;

        return new f.Point(x, y);
      };

      var setZoom = function(e) {
        display.picture.setCenter(getCursorPosition(e)).zoom(2);
        display.refresh();
      };

      var setEquation = function(e) {
        var algorithm, equation;
        switch (e.target.value) {
          default:
          case 'mandelbrot':
            algorithm = bailoutAlgo;
            equation = mandelbrotEquation;
            break;
          case 'tricorn':
            algorithm = bailoutAlgo;
            equation = tricornEquation;
            break;
          case 'burning':
            algorithm = bailoutAlgo;
            equation = burningEquation;
            break;
          case 'newton':
            algorithm = newtonAlgo;
            equation = newtonEquation;
            break;
        }
        display.coloring.algorithm = algorithm;
        display.coloring.algorithm.equation = equation;
        display.refresh();
      };

      var setColoring = function(e) {
        var radius, coloring;
        switch (e.target.value) {
          default:
          case 'bailout':
            radius = 4;
            coloring = bailoutColoring;
            break;
          case 'smoothbailout':
            radius = 1 << 16;
            coloring = smoothBailoutColoring;
            break;
          case 'binary':
            radius = 1 << 16;
            coloring = binaryColoring;
            break;
          case 'angle':
            radius = 4;
            coloring = angleColoring;
            break;
          case 'simple':
            radius = 4;
            coloring = simpleColoring;
            break;
        }
        display.coloring = coloring;
        display.coloring.algorithm.radius = radius;
        display.refresh();
      };

      var setPalette = function(e) {
        var palette;
        switch (e.target.value) {
          default:
          case 'night':
           palette = night;
           break;
          case 'rainbow':
           palette = rainbow;
           break;
          case 'fire':
           palette = fire;
           break;
          case 'sky':
           palette = sky;
           break;
          case 'blacknwhite':
           palette = blacknwhite;
           break;
        }
        display.coloring.palette = palette;
        display.refresh();
      };

      var setJulia = function(e) {
        var c;
        switch (e.target.value) {
          default:
          case '':
            c = undefined;
          break;
          case 'set1':
            c = c1;
            break;
          case 'set2':
            c = c2;
            break;
          case 'set3':
            c = c3;
            break;
          case 'set4':
            c = c4;
            break;
          case 'set5':
            c = c5;
            break;
          case 'set6':
            c = c6;
            break;
        }
        display.coloring.algorithm.c = c;
        display.picture.setRange({re:3, im:3}).setCenter(new f.Complex());
        display.refresh();
      };

      var setIterations = function(e) {
        if (iterations.value > 1) {
          display.coloring.algorithm.maxIter = iterations.value;
          display.refresh();
        }
      };

      /********* Main code *********/

      display.refresh();

      iterations.value = display.coloring.algorithm.maxIter;

      canvas.addEventListener('click', setZoom, false);
      equation.addEventListener('change', setEquation, false);
      coloring.addEventListener('change', setColoring, false);
      palette.addEventListener('change', setPalette, false);
      julia.addEventListener('change', setJulia, false);
      button.addEventListener('click', setIterations, false);
    })();
    </script>
  </body>
</html>
